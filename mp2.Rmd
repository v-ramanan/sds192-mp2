---
title: "Mini Project 2"
author: "Vatsala, Emma, Margaret"
date: "3/8/2019"
output: html_document
code_folding: hide
---

```{r message = FALSE, echo = FALSE, warning = FALSE}
library(tidyverse)
library(ggplot2)
```

```{r message = FALSE, echo = FALSE, warning = FALSE}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```


```{r message = FALSE, echo = FALSE, warning = FALSE, results='hide'}
join_df <- house_elections %>%
              left_join(committees, by=c("state"= "cmte_state"))
join_df
```


```{r message = FALSE, echo = FALSE, warning = FALSE,results='hide'}
fec_df<- join_df %>%
      select(state, candidate_name, party, general_votes, incumbent, cmte_name)

fec_df
```


```{r message = FALSE, echo = FALSE, warning = FALSE, results='hide'}
contributions_df <- contributions %>%
  select(name,transaction_amt,transaction_type, state)%>%
  filter(transaction_amt >0)

contributions_df
```


```{r message = FALSE, echo = FALSE, warning = FALSE, results='hide'}
contributions_fec <- fec_df %>%
    left_join(contributions_df, by = c("cmte_name" = "name"))%>%
    filter(!is.na(transaction_amt)) %>%
  group_by(state.x) %>%
  arrange(state.x)

contributions_fec
```


```{r message = FALSE, echo = FALSE, warning = FALSE, results='hide'}
sum_money<- contributions_fec %>%
  group_by(cmte_name) %>%
  summarize( sum_money = sum(transaction_amt))

sum_money
```


```{r message = FALSE, echo = FALSE, warning = FALSE}
general_votes_df <- contributions_fec %>%
  left_join(sum_money, by = "cmte_name") %>%
  filter(transaction_type== c("24A", "24E"), state.x == "NY") %>%
  select(state.x, party, general_votes, incumbent, candidate_name, cmte_name, transaction_amt, transaction_type, sum_money)

general_votes_df
```

```{r message = FALSE, echo = FALSE, warning = FALSE} 
donations_df <- contributions_fec %>%
  left_join(sum_money, by = "cmte_name")%>%
  filter(transaction_type==c("24E", "24A"), state.x == "NY")%>%
  select(state.x, candidate_name, party, general_votes, incumbent, transaction_type, sum_money)%>%
  group_by(transaction_type, party)%>%
  summarise(new_sum=sum(sum_money))

donations_df
```

```{r message = FALSE, echo = FALSE, warning = FALSE}
general_votes_plot <- ggplot(general_votes_df, aes(x = party, y = general_votes)) + geom_col(position = position_dodge(), width=0.5)

general_votes_plot
```


```{r message = FALSE, echo = FALSE, warning = FALSE}
donations_plot <- ggplot(donations_df, aes(x = party, y = new_sum, fill = transaction_type))+
  geom_col(position = position_dodge())

donations_plot
```

